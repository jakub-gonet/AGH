CC     := gcc
CFLAGS := -g -Wall -Wextra
SHELL  := /bin/bash
TEST_FILES_DIR := ./test

.PHONY: all test clean gen_test_files

all: main

main: block_manager.o main.o
	$(CC) $(CFLAGS) block_manager.o main.o -o main

main.o: main.c lib/vector.h
	$(CC) $(CFLAGS) -c main.c

block_manager.o: lib/block_manager.c lib/block_manager.h lib/vector.h
	$(CC) $(CFLAGS) -c lib/block_manager.c

gen_test_files:
	mkdir -p $(TEST_FILES_DIR)
	base64 -w 128 /dev/urandom | head -c 400000 > $(TEST_FILES_DIR)/400k_8col.txt
	base64 -w 128 /dev/urandom | head -c 400000 > $(TEST_FILES_DIR)/400k_256col.txt

	yes a | head -c 10000000 > $(TEST_FILES_DIR)/10M_a.txt
	yes b | head -c 10000000 > $(TEST_FILES_DIR)/10M_b.txt

test: all
	@echo -e "\e[1m\e[36mRunning tests...\e[0m"
	@echo -e "\e[1mBig files, few of them\e[0m"
	time ./main $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt

	@echo -e "\e[1mMedium files, lots of them\e[0m"
	time ./main $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt $(TEST_FILES_DIR)/400k_8col.txt:$(TEST_FILES_DIR)/400k_256col.txt

	@echo -e "\e[1mBig files, lots of them\e[0m"
	time ./main $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt $(TEST_FILES_DIR)/10M_a.txt:$(TEST_FILES_DIR)/10M_b.txt

clean:
	$(RM) $(TEST_FILES_DIR)
	$(RM) block_manager.o main.o main